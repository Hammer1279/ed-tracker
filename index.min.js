const fs=require("fs"),superagent=require("superagent"),WebSocketClient=require("websocket").client,events=require("events"),EventStream=new events.EventEmitter,Throttle=require("throttle"),client=new WebSocketClient;function log(e){EventStream.emit("data",e),fs.appendFileSync(__dirname+"/log.txt",(new Date).toLocaleString()+" | "+e+"\r\n")}function sendData(e){connection?connection.connected?connection.send(e):log("Error: Not connected yet!"):log("Error: Not Logged in yet!")}client.on("connectFailed",(function(e){log("Connect Error: "+e.toString())})),client.on("connect",(function(e){global.connection=e,log("Connection to Server established"),e.on("error",(function(e){log("Connection Error: "+e.toString())})),e.on("close",(function(){log("Connection Closed")})),e.on("message",(function(e){"utf8"===e.type&&(console.log(e),log("Received: '"+e.utf8Data+"'"))}))}));class EDTracker{constructor(){this.login=function(e){client.connect("ws://api.drillkea.com:80/","ed-tracker","ED-Tracker-Client",{apikey:e})},this.events=EventStream,this.send=sendData,this.appendStream=function(e){const n=new Throttle(50),t=new events.EventEmitter;e.pipe(n).pipe(t),t.on("newLine",e=>{sendData(e)})}}}module.exports=EDTracker;